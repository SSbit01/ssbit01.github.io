---
import { Icon } from "astro-icon"


interface Props {
  name: string
  tags?: string[]
  source: string
  website?: string
}


function toTag(str: string) {
  return str.toLowerCase().replaceAll(/\W/g, "-")
}


const { name, tags, source, website } = Astro.props,
      id = toTag(name)
---



<figure tabindex="1">
  <img src={`/images/projects/${id}.webp`} alt="" loading="lazy" />
  
  <figcaption>
    <h2>{name}</h2>

    {tags?.length && (
      <ul>
        {tags.map(tag => (
          <li>{toTag(tag)}</li>
        ))}
      </ul>
    )}

    {Astro.slots.has("default") && <div class="description"><slot /></div>}
    
    <div class="links">
      <a href={source} target="_blank" rel="noreferrer noopener" title="Source"><Icon name="fluent:code-24-filled" /></a>
      <a href={website} target="_blank" rel="noreferrer noopener" title="Website"><Icon name="lucide:external-link" /></a>
    </div>
  </figcaption>
</figure>



<style lang="stylus">
figure
  position relative
  text-align center
  box-shadow inset 0 0 4px darkslategray
  margin 0
  overflow hidden
  transition opacity 1s, box-shadow .2s
  &:hover, &:focus
    > img
      filter blur(8px) opacity(.5) brightness(.75)
  &:not(:hover):not(:focus)
    > figcaption
      visibility hidden
      opacity 0
      scale .9
  &:focus
    box-shadow inset 0 0 4px 2px steelblue
  > img
    vertical-align top  // PREVENTS EXTRA WHITE SPACE
    aspect-ratio 16 / 9
    width 48em
    max-width 100%
    transition filter .2s
  > figcaption
    display flex
    flex-direction column
    gap clamp(.75em, 2vw, 1em)
    position absolute
    inset 0
    transform-origin bottom
    font-size clamp(.9em, 3.4vw, 1em)
    padding 1rem
    overflow auto
    transition-property visibility, opacity, scale
    transition-duration .4s
    > h2:first-child
      font-size clamp(1.5em, 5.75vw, 3em)
      text-shadow 0 0 4px black
      margin-top auto
      margin-bottom .1em
    > ul
      list-style none
      display flex
      flex-wrap wrap
      align-items center
      justify-content center
      gap .75em
      font-size clamp(.85em, 2vw, 1em)
      padding-left 0
      margin .25em 0
      > li
        background rgba(0, 5, 10, .75)
        padding .2em .4em
        border-radius 16px
        box-shadow 0 0 3px 2px crimson

.description
  display grid
  gap .5em
  line-height 1.25
  > :global(p)
    margin 0
  :global(a)
    color deepskyblue
    text-decoration none
    transition color .15s, text-shadow .15s
    &:hover
      text-decoration underline
    &:active
      text-shadow 0 0 4px

.links
  display flex
  align-items center
  justify-content space-evenly
  margin auto 0
  > a
    display: flex
    flex-direction: column
    align-items center
    text-decoration none
    color gold
    > svg:first-child
      $side = clamp(2em, 7vw, 3em)
      width $side
      height $side
      filter drop-shadow(0 0 4px black)
      translate 0 .5em
      transition filter .2s, translate .2s
    &::after
      content attr(title)
      font-size .75em
      opacity 0
      text-shadow 0 0 .25em black
      margin 0
      transition text-shadow .2s, opacity .2s
    &:hover
      > svg:first-child
        translate 0
      &::after
        opacity 1
    &:active
      > svg:first-child
        filter drop-shadow(0 0 .25em)
        translate 0 -.25em
      &::after
        opacity 1
        text-shadow 0 0 .25em
</style>